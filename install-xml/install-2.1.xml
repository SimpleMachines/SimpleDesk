<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>SimpleDeskTeam:SimpleDesk</id>
	<version>2.0</version>

	<file name="$sourcedir/ManageMaintenance.php"><!-- at the same time we modify the post settings, make sure we check and update SD's if necessary -->
		<operation>
			<search position="replace"><![CDATA[
			$smcFunc['db_change_column']('{db_prefix}messages', 'body', array('type' => 'mediumtext'));]]></search>
			<add><![CDATA[
		{
			$smcFunc['db_change_column']('{db_prefix}messages', 'body', array('type' => 'mediumtext'));
			$smcFunc['db_change_column']('{db_prefix}helpdesk_ticket_replies', 'body', array('type' => 'mediumtext'));
		}]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
			$smcFunc['db_change_column']('{db_prefix}messages', 'body', array('type' => 'text'));]]></search>
			<add><![CDATA[
		{
			$smcFunc['db_change_column']('{db_prefix}messages', 'body', array('type' => 'text'));
			$smcFunc['db_change_column']('{db_prefix}helpdesk_ticket_replies', 'body', array('type' => 'text'));
		}]]></add>
		</operation>
		<!-- @todo: add the check for tickets longer than xxx chars -->
	</file>

	<file name="$sourcedir/ManageLanguages.php"><!-- Language file handling -->
		<operation>
			<search position="after"><![CDATA[	// Check we have themes with a path and a name - just in case - and add the path.]]></search>
			<add><![CDATA[	// Add SimpleDesk to the list of possible places to look.
	$themes['shd'] = array('name' => 'SimpleDesk', 'theme_dir' => $settings['default_theme_dir'] . '/languages/sd_language');
	$lang_dirs['shd'] = $settings['default_theme_dir'] . '/languages/sd_language';
	$themes['shd_plugins'] = array('name' => 'SimpleDesk Plugins', 'theme_dir' => $settings['default_theme_dir'] . '/languages/sd_plugins_lang');
	$lang_dirs['shd_plugins'] = $settings['default_theme_dir'] . '/languages/sd_plugins_lang';

]]></add>
		</operation>
	</file>
</modification>